# vue-passthrough

Vue composable for deep style customization of nested component elements with Tailwind CSS support.

## Core API

### usePassThrough<T>(theme, propsPt?)
Main composable for PassThrough system.

```ts
const { ptMark, ptFor, debugPt } = usePassThrough(theme, props.pt)
```

**Returns:**
- `ptMark(key)` - Get HTML attributes for v-bind (type-safe with defineTheme)
- `ptFor(key)` - Extract nested pt for child components
- `debugPt` - ComputedRef<PtSpec> for debugging

### defineTheme(theme)
Type helper for autocomplete and type safety.

```ts
const theme = defineTheme({
  root: 'grid gap-2',
  input: 'border px-3'
})
```

### PtSpec Type
```ts
interface PtSpec {
  $merge?: boolean   // When true, merges with theme instead of replacing
  $replace?: boolean // When true, explicitly replaces theme (default behavior)
  [key: string]: string | Record<string, any> | PtSpec | boolean | undefined
}
```

## Usage Patterns

### Basic Component
```vue
<template>
  <div v-bind="ptMark('root')">
    <input v-bind="ptMark('input')" />
  </div>
</template>

<script setup>
const props = defineProps<{ pt?: PtSpec }>()
const { ptMark } = usePassThrough({
  root: 'grid gap-2',
  input: 'border px-3'
}, props.pt)
</script>
```

### Parent Usage
```vue
<!-- Merge: attrs add to theme -->
<MyInput pt:root="bg-white" pt:input="border-blue-500" />

<!-- Replace: props override theme -->
<MyInput :pt="{ root: 'flex', input: 'rounded-full' }" />

<!-- Nested attrs -->
<MyInput pt:input:id="my-id" pt:input:onClick="handler" />
```

## Merge Strategy

**Core Rule:**
- `pt:*` attrs = MERGE with theme
- `:pt` props = REPLACE theme (for keys in props)

```vue
<!-- theme: { root: 'grid gap-2', input: 'border' } -->

<!-- attrs: merges -->
<MyInput pt:root="p-4" />
<!-- → root: 'grid gap-2 p-4' -->

<!-- props: replaces -->
<MyInput :pt="{ root: 'flex' }" />
<!-- → root: 'flex' (theme ignored) -->
```

## Advanced Features

### Extend Pattern
```ts
{
  input: 'border px-3',
  inputError: {
    extend: 'input',
    class: 'border-red-500'
  }
}
// inputError inherits from input
```

### Nested Components (ptFor)
```ts
const { ptMark, ptFor } = usePassThrough({
  root: 'flex gap-2',
  badge: {           // nested pt for child
    root: 'px-2',
    label: 'text-xs'
  }
})
```

```vue
<Badge :pt="ptFor('badge')" />
```

### $merge and $replace Flags
By default, `:pt` props use REPLACE strategy. Use flags for explicit control:
- `$merge: true` - merge with theme
- `$replace: true` - explicitly replace (same as default, clearer intent)
- Both set: warns and uses `$merge`

```vue
<!-- Single element (ptMark) -->
<MyInput :pt="{ root: 'flex' }" />                              <!-- REPLACE (implicit) -->
<MyInput :pt="{ root: { $replace: true, class: 'flex' } }" />   <!-- REPLACE (explicit) -->
<MyInput :pt="{ root: { $merge: true, class: 'bg-red' } }" />   <!-- MERGE -->

<!-- Nested component (ptFor) -->
<MyButton :pt="{ badge: { label: 'text-red' } }" />                     <!-- REPLACE -->
<MyButton :pt="{ badge: { $replace: true, label: 'text-red' } }" />     <!-- REPLACE (explicit) -->
<MyButton :pt="{ badge: { $merge: true, label: 'text-red' } }" />       <!-- MERGE -->
```

### Top-level $merge (for ptFor chaining)
When `$merge` is at pt object's top level, it applies to ALL keys:
```ts
// ptFor returns: { $merge: true, root: 'border-1', wrapper: 'px-10' }
// Child's ptMark('root') merges: theme.root + 'border-1'
// Child's ptMark('wrapper') merges: theme.wrapper + 'px-10'
```

**$merge cascades to children**: If props has `$merge: true`, ptFor automatically adds it to the result, so child components also merge with their themes.
```ts
// Page: { badge: { $merge: true, root: 'bg-red' } }
// MyInput theme.badge: { root: 'border-1' }  (no $merge)
// ptFor result: { $merge: true, root: 'border-1 bg-red' }  ($merge added!)
// MyBadge: merges with its theme because $merge cascaded
```

Override order for 3-level nesting:
```
Badge theme → MyInput badge → Page pt.badge
(base)        (middle)        (final)
```

## Key Points for LLMs

1. **Strings are class shortcuts**: `root: "grid"` → `root: { class: "grid" }`
2. **tailwind-merge**: Automatic Tailwind class conflict resolution
3. **mergeProps**: Event handlers chain, don't override
4. **Replace vs Merge**: `:pt` props replace, `pt:*` attrs merge
5. **$merge/$replace flags**: Use `$merge: true` to merge, `$replace: true` for explicit replace. If both set, `$merge` wins with warning
6. **Top-level $merge**: Applies merge strategy to ALL keys in pt object (enables ptFor chaining)
7. **Type safety**: Use `defineTheme` for autocomplete
8. **Reactivity**: propsPt accepts ref/computed
9. **propsPt required**: Always pass props.pt to usePassThrough, even if undefined
